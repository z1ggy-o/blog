<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SOSP &#39;97 - The design of a practical system for fault-tolerant virtual machines | Ziggy&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/blog/img/favicon.ico">
    <meta name="description" content="Personal blogs and wikis">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/blog/assets/css/0.styles.802db94a.css" as="style"><link rel="preload" href="/blog/assets/js/app.e93f84ee.js" as="script"><link rel="preload" href="/blog/assets/js/2.5f4b96d7.js" as="script"><link rel="preload" href="/blog/assets/js/23.9a9fd78b.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.186ef0aa.js"><link rel="prefetch" href="/blog/assets/js/11.a86b52a7.js"><link rel="prefetch" href="/blog/assets/js/12.a1136d27.js"><link rel="prefetch" href="/blog/assets/js/13.ff2c4670.js"><link rel="prefetch" href="/blog/assets/js/14.457f2c8c.js"><link rel="prefetch" href="/blog/assets/js/15.6208c784.js"><link rel="prefetch" href="/blog/assets/js/16.64dd4f4a.js"><link rel="prefetch" href="/blog/assets/js/17.55f7112c.js"><link rel="prefetch" href="/blog/assets/js/18.13638b8d.js"><link rel="prefetch" href="/blog/assets/js/19.4cdde176.js"><link rel="prefetch" href="/blog/assets/js/20.826d32cf.js"><link rel="prefetch" href="/blog/assets/js/21.4e6f0671.js"><link rel="prefetch" href="/blog/assets/js/22.31699819.js"><link rel="prefetch" href="/blog/assets/js/24.7986b4d7.js"><link rel="prefetch" href="/blog/assets/js/25.d71b9122.js"><link rel="prefetch" href="/blog/assets/js/26.329cf0b3.js"><link rel="prefetch" href="/blog/assets/js/27.adb54146.js"><link rel="prefetch" href="/blog/assets/js/28.8f3e00d0.js"><link rel="prefetch" href="/blog/assets/js/29.f90ab39f.js"><link rel="prefetch" href="/blog/assets/js/3.c53c04e3.js"><link rel="prefetch" href="/blog/assets/js/30.cbeee5c0.js"><link rel="prefetch" href="/blog/assets/js/31.4c6252e6.js"><link rel="prefetch" href="/blog/assets/js/32.76d84000.js"><link rel="prefetch" href="/blog/assets/js/33.926a1eaa.js"><link rel="prefetch" href="/blog/assets/js/34.e61db008.js"><link rel="prefetch" href="/blog/assets/js/35.1f9c32a2.js"><link rel="prefetch" href="/blog/assets/js/36.44c19630.js"><link rel="prefetch" href="/blog/assets/js/37.3f89591a.js"><link rel="prefetch" href="/blog/assets/js/38.89d2fed2.js"><link rel="prefetch" href="/blog/assets/js/39.aa7a6d7b.js"><link rel="prefetch" href="/blog/assets/js/4.27b51db5.js"><link rel="prefetch" href="/blog/assets/js/40.167faf08.js"><link rel="prefetch" href="/blog/assets/js/41.aa0aa0fd.js"><link rel="prefetch" href="/blog/assets/js/42.9b534057.js"><link rel="prefetch" href="/blog/assets/js/43.1d8d0c92.js"><link rel="prefetch" href="/blog/assets/js/44.02be069d.js"><link rel="prefetch" href="/blog/assets/js/45.bdbf7611.js"><link rel="prefetch" href="/blog/assets/js/46.e695b7f9.js"><link rel="prefetch" href="/blog/assets/js/47.ab9934c1.js"><link rel="prefetch" href="/blog/assets/js/48.bbb27d8e.js"><link rel="prefetch" href="/blog/assets/js/49.558f223c.js"><link rel="prefetch" href="/blog/assets/js/5.9b6dc29e.js"><link rel="prefetch" href="/blog/assets/js/50.c6dce237.js"><link rel="prefetch" href="/blog/assets/js/51.80faa8c8.js"><link rel="prefetch" href="/blog/assets/js/52.b74f159e.js"><link rel="prefetch" href="/blog/assets/js/53.750a01b7.js"><link rel="prefetch" href="/blog/assets/js/54.c69b6309.js"><link rel="prefetch" href="/blog/assets/js/55.ee0a152f.js"><link rel="prefetch" href="/blog/assets/js/56.3917d1d7.js"><link rel="prefetch" href="/blog/assets/js/57.c0cf0a53.js"><link rel="prefetch" href="/blog/assets/js/58.1c316d1a.js"><link rel="prefetch" href="/blog/assets/js/59.7c26bb76.js"><link rel="prefetch" href="/blog/assets/js/6.ac011902.js"><link rel="prefetch" href="/blog/assets/js/60.082a63b3.js"><link rel="prefetch" href="/blog/assets/js/61.c54fff04.js"><link rel="prefetch" href="/blog/assets/js/62.635a0c4f.js"><link rel="prefetch" href="/blog/assets/js/63.a5e9dfc4.js"><link rel="prefetch" href="/blog/assets/js/64.dd4097c5.js"><link rel="prefetch" href="/blog/assets/js/65.7db1f157.js"><link rel="prefetch" href="/blog/assets/js/7.c3622e2f.js"><link rel="prefetch" href="/blog/assets/js/8.86e22913.js"><link rel="prefetch" href="/blog/assets/js/9.7d24983f.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.802db94a.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Ziggy's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系列文章" class="dropdown-title"><!----> <span class="title" style="display:;">系列文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/089ecd/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><!----> <span class="title" style="display:;">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/booknotes/" class="nav-link">读书笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/papernotes/" class="nav-link">论文笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Logs" class="dropdown-title"><a href="/blog/logs/" class="link-title">Logs</a> <span class="title" style="display:none;">Logs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/logs/weekly/" class="nav-link">周记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/blog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/blog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/blog/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="系列文章" class="dropdown-title"><!----> <span class="title" style="display:;">系列文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/089ecd/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><!----> <span class="title" style="display:;">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/booknotes/" class="nav-link">读书笔记</a></li><li class="dropdown-item"><!----> <a href="/blog/papernotes/" class="nav-link">论文笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Logs" class="dropdown-title"><a href="/blog/logs/" class="link-title">Logs</a> <span class="title" style="display:none;">Logs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/logs/weekly/" class="nav-link">周记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/blog/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/blog/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/blog/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>BookNotes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>x86汇编语言-王爽</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/pages/ff929e/" class="sidebar-link">Note - x86 汇编语言（1）：计算机基础和实模式</a></li><li><a href="/blog/pages/965b17/" class="sidebar-link">Note - x86 汇编语言（2）：保护模式下的分段寻址方法和权限设计</a></li><li><a href="/blog/pages/2701e3/" class="sidebar-link">Note - x86 汇编语言（3）：多任务支持</a></li><li><a href="/blog/pages/547566/" class="sidebar-link">Note - x86 汇编语言（4）：分页机制</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PaperNotes</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/blog/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/blog/categories/?category=Notes" title="分类" data-v-06225672>Notes</a></li><li data-v-06225672><a href="/blog/categories/?category=PaperNotes" title="分类" data-v-06225672>PaperNotes</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/z1ggy-o" target="_blank" title="作者" class="beLink" data-v-06225672>gyzhu</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-05-23</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">SOSP '97 - The design of a practical system for fault-tolerant virtual machines<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>[^1]: D. J. Scales, M. Nelson, and G. Venkitachalam, “The design of a practical system for fault-tolerant virtual machines,” SIGOPS Oper. Syst. Rev., vol. 44, no. 4, pp. 30–39, Dec. 2010, doi: 10.1145/1899928.1899932.</p> <h2 id="motivation-1"><a href="#motivation-1" class="header-anchor">#</a> MOTIVATION [^1]</h2> <p>A common approach to implementing fault-tolerant servers is the primary/backup approach. One way of replicating the state on the backup server is to ship changes to all state of the primary (e.g., CPU, memory, and I/Os devices) to the backup. However this approach needs high network bandwidth, and also leads to significant performance issues.</p> <h2 id="contribution"><a href="#contribution" class="header-anchor">#</a> CONTRIBUTION</h2> <p>Shipping all the changes to the backup server asks for high network bandwidth. To reduce the demand of network, we can use the &quot;state-machine approach&quot;, which models the servers as deterministic state machines that are kept in sync by starting them from the same initial state and ensuring that they receive the same input requests in the same order.</p> <p>There are three challenges:</p> <ol><li>correctly capturing all the input and non-determinism</li> <li>correctly applying the inputs and non-determinism to the backup</li> <li>low performance degradation</li></ol> <p>To handle these challenges, they implemented a fault-tolerant virtual machines in VMware vSphere 4.0. This system reduces the performance of real applications by less than 10%, and needs less than 20 Mb/s network bandwidth.</p> <h2 id="solution"><a href="#solution" class="header-anchor">#</a> SOLUTION</h2> <ul><li>There is one primary VM and one backup VM on different hosts. All input goes to the primary. And the input is sent to the backup VM via logging channel (network).</li> <li>A VM has a broad set of inputs and some additional information is needed for non-deterministic operations. They use the <em>VMware deterministic replay</em> to records the inputs of a VM and all possible non-determinism associated with the VM execution in a stream of log entries written to a log file.</li> <li>They design a protocol to ensure the failover (i.e., switching to the backup) is transparent to the clients. The core idea is that before send an output to the external world, we must need to make sure the backup VM has received the log entry that produces the output.</li> <li>The failure detection is handled by UDP heartbeating messages and  logging traffic.</li> <li>To avoid &quot;split-brain&quot; situation, they store a flag in the shared storage, so VMs can know if there is any other running primary.</li></ul> <h2 id="limitation"><a href="#limitation" class="header-anchor">#</a> LIMITATION</h2> <p>The limitation is that the implementation only works for uni-processor machines because recording and replaying the execution of a multi-processor VM can lead to significant performance issues (accessing to shared memory is non-deterministic operation).</p> <h2 id="main-takeaway"><a href="#main-takeaway" class="header-anchor">#</a> MAIN TAKEAWAY</h2> <p>It is helpful to distinguish between internal and external and internal events of the system. For an infrastructure, only external events can really affect other applications.</p></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/blog/tags/?tag=distributed-systems" title="标签">#distributed-systems</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/09/17, 14:09:04</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/blog/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/blog/pages/c93ce8/"><div>
            2024-01-W2
            <!----></div></a> <span class="date">01-12</span></dt></dl><dl><dd>02</dd> <dt><a href="/blog/pages/237d08/"><div>
            FAST'20 - BCW: Buffer-Controlled Writes to HDDs for SSD-HDD Hybrid Storage Server
            <!----></div></a> <span class="date">09-17</span></dt></dl><dl><dd>03</dd> <dt><a href="/blog/pages/2f7119/"><div>
            LevelDB 源码分析笔记
            <!----></div></a> <span class="date">08-22</span></dt></dl> <dl><dd></dd> <dt><a href="/blog/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/z1ggy-o" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2024
    <span>Ziggy| <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.e93f84ee.js" defer></script><script src="/blog/assets/js/2.5f4b96d7.js" defer></script><script src="/blog/assets/js/23.9a9fd78b.js" defer></script>
  </body>
</html>
